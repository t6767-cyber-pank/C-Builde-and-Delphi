//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "main.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm1 *Form1;
//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
void __fastcall TForm1::FormActivate(TObject *Sender)
{
CategoryPanel3->Visible=false;
CategoryPanelGroup1->CollapseAll();
tab=1;
}
//---------------------------------------------------------------------------

void TForm1::clearmas()
{
for (int i = 0; i < 15; i++) {
a[i]="0";
b[i]="0";
}
}

void TForm1::zap(int x, int y)
{
ADOConnection1->Connected=false;
ADOConnection1->ConnectionString="Provider=SQLOLEDB.1;Password=timur666777;Persist Security Info=True;User ID=t67;Initial Catalog=kafe;Data Source=localhost";
ADOConnection1->Connected=true;
switch (x)
 {
 case 1: switch(y)
		 {
		   case 1:
				   clearmas();
				   Panel3->Visible=true;
				   Panel2->Visible=true;
				   Panel1->Visible=true;
				   Label1->Caption="Имя пользователя";
				   Label2->Caption="Пароль";
				   Label3->Caption="Статус пользователя";
				   ComboBox1->Items->Clear();
				   ComboBox1->Items->Add("Сотрудник");
				   ComboBox1->Items->Add("Администратор");
				   CategoryPanel3->Visible=true;
				   ADOQuery1->SQL->Text="select * from polzov";
				   ADOQuery1->Active=true;
				   a[1]="Номер п/п";
				   a[2]="Ф.И.О";
				   a[3]="Статус";
				   b[1]="fio";
				   b[2]="status";
				   b[3]="id_chel";
				   adtotab(3, StringGrid1);
				   break;
		   case 2:
					ADOQuery1->SQL->Text="insert into polzov(fio, pass, status) values(:fio, :pass, :status)";
					ADOQuery1->Parameters->ParamByName("fio")->Value=Edit1->Text;
					ADOQuery1->Parameters->ParamByName("pass")->Value=Edit2->Text;
					ADOQuery1->Parameters->ParamByName("status")->Value=ComboBox1->Text;
					ADOQuery1->ExecSQL();
					zap(1,1);
					break;
		   case 3:
					ADOQuery1->SQL->Text="update polzov set fio=:fio, pass=:pass, status=:status where id_chel=:id_chel";
					ADOQuery1->Parameters->ParamByName("fio")->Value=Edit1->Text;
					ADOQuery1->Parameters->ParamByName("pass")->Value=Edit2->Text;
					ADOQuery1->Parameters->ParamByName("status")->Value=ComboBox1->Text;
					ADOQuery1->Parameters->ParamByName("id_chel")->Value=StringGrid1->Cells[3][StringGrid1->Row];
					ADOQuery1->ExecSQL();
					zap(1,1);
					break;
		 }
		 break;
 case 2: switch(y)
		 {
		   case 1:
				   clearmas();
				   Label1->Caption="Категория продукта";
				   Panel1->Visible=true;
				   Panel2->Visible=false;
				   Panel3->Visible=false;
				   CategoryPanel3->Visible=true;
				   ADOQuery1->SQL->Text="select * from categoryeda";
				   ADOQuery1->Active=true;
				   a[1]="Номер п/п";
				   a[2]="Категория";
				   b[1]="name_cat";
				   b[2]="id_category";
				   adtotab(2, StringGrid1);
				   break;
		   case 2:
					ADOQuery1->SQL->Text="insert into categoryeda(name_cat) values(:name_cat)";
					ADOQuery1->Parameters->ParamByName("name_cat")->Value=Edit1->Text;
					ADOQuery1->ExecSQL();
					zap(2,1);
					break;
		   case 3:
					ADOQuery1->SQL->Text="update categoryeda set name_cat=:name_cat where id_category=:id_category";
					ADOQuery1->Parameters->ParamByName("name_cat")->Value=Edit1->Text;
					ADOQuery1->Parameters->ParamByName("id_category")->Value=StringGrid1->Cells[2][StringGrid1->Row];
					ADOQuery1->ExecSQL();
					zap(2,1);
					break;
		   case 4:  ADOQuery1->SQL->Text="select * from categoryeda";
					ADOQuery1->Active=true;
					adtocb(ComboBox1, "name_cat");
					break;
		   case 5:  ADOQuery1->SQL->Text="select * from categoryeda where name_cat=:name_cat";
					ADOQuery1->Parameters->ParamByName("name_cat")->Value=xval1;
					ADOQuery1->Active=true;
					xval1=ADOQuery1->FieldByName("id_category")->Value;
					break;
		 }
		 break;
 case 3: switch(y)
		 {
		   case 1:
				   clearmas();
				   Panel3->Visible=true;
				   Panel2->Visible=true;
				   Panel1->Visible=true;
				   Label1->Caption="Наименование блюда";
				   Label2->Caption="Цена";
				   Label3->Caption="Категория";
				   zap(2,4);
				   CategoryPanel3->Visible=true;
				   ADOQuery1->SQL->Text="select * from blud b, categoryeda c where b.id_category=c.id_category";
				   ADOQuery1->Active=true;
				   a[1]="Номер п/п";
				   a[2]="Блюдо";
				   a[3]="Цена";
				   a[4]="Категория";
				   b[1]="nameblud";
				   b[2]="cena";
				   b[3]="name_cat";
				   b[4]="id_blud";
				   adtotab(4, StringGrid1);
				   break;
		   case 2:
					xval1=ComboBox1->Text;
					zap(2, 5);
					ADOQuery1->SQL->Text="insert into blud(nameblud, cena, id_category) values(:nameblud, :cena, :id_category)";
					ADOQuery1->Parameters->ParamByName("nameblud")->Value=Edit1->Text;
					ADOQuery1->Parameters->ParamByName("cena")->Value=Edit2->Text;
					ADOQuery1->Parameters->ParamByName("id_category")->Value=xval1;
					ADOQuery1->ExecSQL();
					zap(3,1);
					break;
		   case 3:
					ADOQuery1->SQL->Text="update polzov set fio=:fio, pass=:pass, status=:status where id_chel=:id_chel";
					ADOQuery1->Parameters->ParamByName("fio")->Value=Edit1->Text;
					ADOQuery1->Parameters->ParamByName("pass")->Value=Edit2->Text;
					ADOQuery1->Parameters->ParamByName("status")->Value=ComboBox1->Text;
					ADOQuery1->Parameters->ParamByName("id_chel")->Value=StringGrid1->Cells[3][StringGrid1->Row];
					ADOQuery1->ExecSQL();
					zap(1,1);
					break;
		 }
		 break;
 }
}

void TForm1::adtotab(int X,  TStringGrid *StringGrid1)
{
StringGrid1->ColCount=X;
StringGrid1->ColWidths[0]=57;
StringGrid1->ColWidths[1]=400;
StringGrid1->Cells[0][0]=a[1];
StringGrid1->Cells[1][0]=a[2];
StringGrid1->Cells[2][0]=a[3];
StringGrid1->Cells[3][0]=a[4];
StringGrid1->Cells[4][0]=a[5];
StringGrid1->Cells[5][0]=a[6];
StringGrid1->Cells[6][0]=a[7];
StringGrid1->Cells[7][0]=a[8];
StringGrid1->Cells[8][0]=a[9];
StringGrid1->Cells[9][0]=a[10];
StringGrid1->Cells[10][0]=a[11];
StringGrid1->Cells[11][0]=a[12];
StringGrid1->Cells[12][0]=a[13];
StringGrid1->Cells[13][0]=a[14];
StringGrid1->Cells[14][0]=a[15];
int i=1;
StringGrid1->RowCount=ADOQuery1->RecordCount+1;
  if (StringGrid1->RowCount>1)
  {
  StringGrid1->FixedCols=1;
  StringGrid1->FixedRows=1;
  }
  ADOQuery1->First();
  while (!ADOQuery1->Eof)
  {
	StringGrid1->Cells[0][i]=i;
	for (int j= 1; j<15; j++)
	{
	if (b[j]!="0") StringGrid1->Cells[j][i]=Trim(ADOQuery1->FieldByName(b[j])->Value);
	}
	i++;
	ADOQuery1->Next();
  }
}


void TForm1::adtocb(TComboBox *cb, String val1)
{
cb->Items->Clear();
ADOQuery1->First();
while (!ADOQuery1->Eof){
 cb->Items->Add(Trim(ADOQuery1->FieldByName(val1)->Value));
 ADOQuery1->Next();
}
}

void __fastcall TForm1::Button1Click(TObject *Sender)
{
tab=1;
zap(tab,1);
}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button4Click(TObject *Sender)
{
zap(tab,2);
}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button3Click(TObject *Sender)
{
zap(tab, 3);
}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button5Click(TObject *Sender)
{
tab=2;
zap(tab,1);
}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button6Click(TObject *Sender)
{
tab=3;
zap(tab,1);
}
//---------------------------------------------------------------------------

